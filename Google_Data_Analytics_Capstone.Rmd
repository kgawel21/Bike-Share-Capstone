---
title: "Google Data Analytics Bike Sharing Capstone Project"
author: "Konrad Gawel"
date: "7/19/2021"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction

The following case study is a Capstone project requirement for the Google Data Analytics Professional Certificate. The case study is based on bike share data generated by fictional company Cyclistic.

## Scenario

In 2016, Cyclistic launched a successful bike-share offering. Since then, the program has grown to a fleet of 5,824 bicycles that are geotracked and locked into a network of 692 stations across Chicago. The bikes can be unlocked from one station and returned to any other station in the system anytime. Until now, Cyclisticâ€™s marketing strategy relied on building general awareness and appealing to broad consumer segments. One approach that helped make these things possible was the flexibility of its pricing plans: single-ride passes, full-day passes, and annual memberships. Customers who purchase single-ride or full-day passes are referred to as casual riders. Customers who purchase annual memberships are Cyclistic members.

Cyclistic's Director of Marketing believes the company's future success depends on maximizing the number of annual memberships. Therefore, the goal of the case study is to understand how casual riders and annual members use Cyclistic's bikes differently. From these insights, a new marketing strategy will be designed to hopefully convert causal riders to annual members. 

## Data source

While Cyclistic is a fictional company, the real world data used for the case study is from an actual company named Divy. The data has been made available by Motivate International Inc. and can be found here:

https://divvy-tripdata.s3.amazonaws.com/index.html 

## Load libriaries

It will be necessary to load the following libraries into R in order import, clean, wrangle and visualize the data.

```{r}
library(tidyverse)
library(janitor)
library(lubridate)
library(ggplot2)
library(readxl)
library(data.table)
```

## Load CSV files into R

The following code will import each month's trip data into its own dataframe

```{r}

apr20 <- read_csv("202004-divvy-tripdata.csv")

may20 <- read_csv("202005-divvy-tripdata.csv")

jun20 <- read_csv("202006-divvy-tripdata.csv")

jul20 <- read_csv("202007-divvy-tripdata.csv")

aug20 <- read_csv("202008-divvy-tripdata.csv")

sep20 <- read_csv("202009-divvy-tripdata.csv")

oct20 <- read_csv("202010-divvy-tripdata.csv")

nov20 <- read_csv("202011-divvy-tripdata.csv")

dec20 <- read_csv("202012-divvy-tripdata.csv")

jan21 <- read_csv("202101-divvy-tripdata.csv")

feb21 <- read_csv("202102-divvy-tripdata.csv")

mar21 <- read_csv("202103-divvy-tripdata.csv")

```

## Clean and wrangle data

After importing all individual months of data, it was necessary to check to see if the data is in consistent format.

```{r}

compare_df_cols_same(apr20, may20, jun20, jul20, aug20, sep20, oct20, nov20, dec20, jan21, feb21, mar21)

```

start_station_id and end_station_id in dec20, jan21, feb21 and mar21 need to be adjusted from character types to numeric types.

```{r}

dec20 <- dec20 %>% 
  mutate(start_station_id = as.numeric(start_station_id),
         end_station_id = as.numeric(end_station_id))

jan21 <- jan21 %>% 
  mutate(start_station_id = as.numeric(start_station_id),
         end_station_id = as.numeric(end_station_id))

feb21 <- feb21 %>% 
  mutate(start_station_id = as.numeric(start_station_id),
         end_station_id = as.numeric(end_station_id))

mar21 <- mar21 %>% 
  mutate(start_station_id = as.numeric(start_station_id),
         end_station_id = as.numeric(end_station_id))

```

Recheck to see if all individual months of data are consistent now.

```{r}

compare_df_cols_same(apr20, may20, jun20, jul20, aug20, sep20, oct20, nov20, dec20, jan21, feb21, mar21)

```

Now that all individual months of data are in consistent format, combined all months into one single dataframe and use glimpse to get a quick understanding of the data structure.

```{r}

all_trips <- bind_rows(apr20, may20, jun20, jul20, aug20, sep20, oct20, nov20, dec20, jan21, feb21, mar21)

glimpse(all_trips)

```

The data can be cleaned up a bit, removed start_lat, start_lng, end_lat, end_lng as these columns are not necessary for our specific analysis. Also rename some columns to make more clear/descriptive

```{r}

all_trips_v1 <- all_trips %>% 
  select(-c(start_lat, start_lng, end_lat, end_lng)) %>% 
  rename(ride_type = rideable_type,
         start_time = started_at,
         end_time = ended_at,
         customer_type = member_casual)

glimpse(all_trips_v1)

```

I realize start_time and end_time are character types, these columns should be in date-time format to allow for ride length analysis

```{r}

all_trips_v2 <- all_trips_v1 %>% 
  mutate(start_time = mdy_hm(start_time),
         end_time = mdy_hm(end_time))

```

Now we are able to add ride_length_minutes, month_year, day_of_week and time columns which can be used to expand on our analysis. The time column needs to be converted to a character vector first and then back to POSIXct format. 

```{r}

all_trips_v3 <- all_trips_v2 %>% 
  mutate(ride_length_minutes = as.numeric(end_time - start_time) / 60,
         month_year = format(as.Date(start_time), '%b_%y'),
         day_of_week = lubridate::wday(start_time, label = TRUE, abbr = FALSE))

all_trips_v3$time <- format(all_trips_v3$start_time, format = "%H:%M")
all_trips_v3$time <- as.POSIXct(all_trips_v3$time, format = "%H:%M")

all_trips_v3$month_year <- ordered(all_trips_v3$month_year, levels=c("Apr_20", "May_20", "Jun_20", "Jul_20", "Aug_20", "Sep_20", "Oct_20", "Nov_20", "Dec_20", "Jan_21", "Feb_21", "Mar_21"))

glimpse(all_trips_v3)

```

Check for inconsistencies in the data again

```{r}

summary(all_trips_v3)
unique(all_trips_v3$end_station_name)

```

It is apparent that there are negative ride lengths and that some company "test" sites which should be removed

```{r}

all_trips_v4 <- all_trips_v3[all_trips_v3$ride_length_minutes > 0,]

all_trips_v5 <- all_trips_v4[!((all_trips_v4$start_station_name %like% "TEST" | all_trips_v4$start_station_name %like% "test")),]


```

## Conduct some descriptive analysis by customer type

```{r}

all_trips_grouped_summary <- all_trips_v5 %>%
  group_by(customer_type) %>% 
  summarize(number_of_rides = n(),
            total_minutes = sum(ride_length_minutes),
            min_ride_length = min(ride_length_minutes),
            max_ride_length = max(ride_length_minutes),
            mean_ride_length = mean(ride_length_minutes),
            median_ride_length = median(ride_length_minutes)) %>% 
  mutate(percentage_of_rides = prop.table(number_of_rides) * 100,
         percentage_of_ride_length = prop.table(total_minutes) * 100)

View(all_trips_grouped_summary)

```

Explore the distribution of rides based on customer_type and days_of_week

```{r}

days_of_week_distribution  <- all_trips_v5 %>%
  group_by(customer_type, day_of_week) %>% 
  summarize(number_of_rides = n(),
            mean_ride_length = mean(ride_length_minutes),
            median_ride_length = median(ride_length_minutes))

View(days_of_week_distribution)

```

Check to see the trip distribution by ride_type

```{r}

ride_type_summary <- all_trips_v5 %>% 
  group_by(ride_type) %>% 
  summarise(number_of_rides = n()) %>% 
  mutate(percentage_of_rides = prop.table(number_of_rides) * 100)

View(ride_type_summary)

```


## Data visualization

Visualize number of trips by customer type vs different days of the week

```{r}

all_trips_v5 %>% 
  group_by(customer_type, day_of_week) %>% 
  summarise(number_of_rides = n()) %>% 
  arrange(customer_type, day_of_week) %>% 
  ggplot(aes(x = day_of_week, y = number_of_rides, fill = customer_type))  +
  labs(title = "Number of Trips by Customer Type Vs. Days of Week") +
  scale_y_continuous(labels = function(x) format(x, scientific = FALSE)) +
  geom_col(position = "dodge")

```

Visualize number of trips by customer type vs. month

```{r}

all_trips_v5 %>% 
  group_by(customer_type, month_year) %>% 
  summarise(number_of_rides = n()) %>% 
  arrange(customer_type, month_year) %>% 
  ggplot(aes(x = month_year, y = number_of_rides, fill = customer_type))  +
  labs(title = "Number of Trips by Customer Type Vs. Month") +
  scale_y_continuous(labels = function(x) format(x, scientific = FALSE)) +
  geom_col(position = "dodge") +
  theme(axis.text.x = element_text(angle = 25))

```

Visualize average trip time by customer type vs days of the week

```{r}

all_trips_v5 %>% 
  group_by(customer_type, day_of_week) %>% 
  summarise(average_trip_duration = mean(ride_length_minutes)) %>% 
  arrange(customer_type, day_of_week) %>% 
  ggplot(aes(x = day_of_week, y = average_trip_duration, fill = customer_type))  +
  labs(title = "Average Duration of Trip by Customer Type Vs. Days of Week") +
  geom_col(position = "dodge")

```

Visualize average trip time by customer type vs month

```{r}

all_trips_v5 %>% 
  group_by(customer_type, month_year) %>% 
  summarise(average_trip_duration = mean(ride_length_minutes)) %>% 
  arrange(customer_type, month_year) %>% 
  ggplot(aes(x = month_year, y  = average_trip_duration, fill = customer_type))  +
  labs(title = "Average Duration of Trip by Customer Type Vs. Month") +
  geom_col(position = "dodge") +
  theme(axis.text.x = element_text(angle = 25))

```

Visualize the number of rides by ride type

```{r}

all_trips_v5 %>% 
  group_by(ride_type, customer_type) %>% 
  summarise(number_of_rides = n()) %>% 
  ggplot(aes(x = ride_type, y = number_of_rides, fill = customer_type))  +
  geom_bar(stat = "identity") +
  labs(title = "Ride Type Vs. Number of Rides") 

```

Visualize ride demand over the time of day

```{r}

all_trips_v5 %>%  
  group_by(customer_type, time) %>% 
  summarise(number_of_trips = n()) %>%
  ggplot(aes(x = time, y = number_of_trips, color = customer_type, group = customer_type)) +
  geom_line() +
  scale_x_datetime(date_breaks = "1 hour", minor_breaks = NULL,
                   date_labels = "%H:%M", expand = c(0,0)) +
  theme(axis.text.x = element_text(angle = 45)) +
  labs(title ="Ride Demand over 24 hours of a day", x = "Time of the day")

```


## Key takeaways

* Overall, member riders made up approximately 59% of the total number of rides and casual riders made up the remaining 41% of rides taken between April 2020 and March 2021.


* Although member riders accounted for a greater number of rides, casual riders took significantly longer rides on average. Casual riders accounted for approximately 66% of the total trip duration compared to member riders who accounted for 34% of total trip duration. In addition, casual riders had a mean ride length of 45 minutes and a median ride length of 21 minutes compared to member riders who had a mean ride length of 16 minutes and a median ride length of 12 minutes. 


* Member riders seem to take rides fairly consistently throughout each day of the week while casual riders utilize the bike share service more often on weekends. 


* Not surprisingly, the number of rides for both member and casual riders is higher in warmer months (June, July, August, September, October) compared to the colder months (November, December, January, February).


* The average trip duration for casual riders is typically twice as long as member riders no matter what the day of the week is. 


* Member riders had a similar ride duration no matter what month it was while casual riders took longer rides on average in February, April, May, June, July and August.


* While customers have the option of using a classic bike, docked bike or electric bike, the overwhelming majority of rides (73%) are taken on a docked bike. 

* Member ridership seems to be significant around 7am-9am and 5pm-7pm, seemingly tying into people arriving and leaving work. Casual ridership increases throughout the day and peaks around 5pm-6pm. 


## Without knowledge of the current pricing between single-rides, day passes and annual memberships it is dificult to propose an optomized cost structure. However, some general recomendations can be made:

* Casual riders use the bike share service more often on the weekends and in the afternoon. Offering casual riders discounts between Monday-Friday may increase ridership on those days. In addition, offering early bird specials or discounts in off-peak hours may also increase casual ridership.

* Offering casual riders a discounted annual membership may incentivize casual riders to make the switch over to becoming members. 

* Also, it may be beneficial to transition the single-ride pass and day pass structure to a pay-per-minute or similar time sensitive pricing strategy since casual riders take significantly longer rides than member riders. 



